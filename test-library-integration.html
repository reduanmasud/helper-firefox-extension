<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Markdown Library Integration</title>
    <link rel="stylesheet" href="sidebar/sidebar.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-title {
            color: #333;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .test-input {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 15px;
            font-family: monospace;
            white-space: pre-wrap;
            border: 1px solid #e9ecef;
            font-size: 12px;
        }
        .test-output {
            border: 1px solid #dee2e6;
            border-radius: 4px;
            min-height: 100px;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 20px;
            font-weight: bold;
        }
        .status.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .feature-test {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin: 2px;
        }
        .feature-pass {
            background-color: #d4edda;
            color: #155724;
        }
        .feature-fail {
            background-color: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <h1>Markdown Library Integration Test</h1>
    <div id="status" class="status">Loading...</div>

    <div class="test-container">
        <h2 class="test-title">Library Status Check</h2>
        <div id="library-status"></div>
    </div>

    <div class="test-container">
        <h2 class="test-title">Comprehensive Table Test</h2>
        <div class="test-input" id="table-input">| Feature | Status | Priority | Notes |
|---------|:------:|:--------:|-------|
| Tables | ✅ Working | High | Full support with alignment |
| ~~Strikethrough~~ | ✅ Working | Medium | Uses del tag |
| **Bold** text | ✅ Working | High | Standard formatting |
| *Italic* text | ✅ Working | High | Standard formatting |
| `Code` inline | ✅ Working | Medium | Inline code blocks |</div>
        <div class="test-output analysis-results enhanced-results" id="table-output"></div>
    </div>

    <div class="test-container">
        <h2 class="test-title">Advanced Features Test</h2>
        <div class="test-input" id="advanced-input"># Analysis Report

## Summary

> **Important**: This is a comprehensive test of all markdown features supported by the marked.js library.

### Performance Metrics

| Metric | Current | Target | Status |
|--------|:-------:|:------:|:------:|
| Load Time | 3.2s | <2s | ❌ Needs work |
| First Paint | 1.8s | <1s | ❌ Needs work |
| Accessibility | 85% | >90% | ⚠️ Close |

---

### Issues Found

1. **High Priority**
   - Missing alt text on images
   - ~~Flash content~~ (removed)
   - Unoptimized image sizes

2. **Medium Priority**
   - Update meta descriptions
   - Add structured data

3. **Low Priority**
   - Minor CSS optimizations

> **Note**: All ~~deprecated~~ features have been removed.

---

### Code Examples

Here's some `inline code` and a code block:

```javascript
function renderMarkdown(text) {
    // Now using marked.js library
    return marked.parse(text);
}
```

```html
<table>
  <thead>
    <tr><th>Header</th></tr>
  </thead>
  <tbody>
    <tr><td>Data</td></tr>
  </tbody>
</table>
```

### Final Notes

- All features are now **working correctly**
- XSS protection is ~~enabled~~ **active**
- Performance is optimized</div>
        <div class="test-output analysis-results enhanced-results" id="advanced-output"></div>
    </div>

    <div class="test-container">
        <h2 class="test-title">Feature Detection Results</h2>
        <div id="feature-results"></div>
    </div>

    <!-- Load the bundled markdown renderer -->
    <script src="sidebar/markdown-renderer.bundle.js"></script>
    
    <script>
        function updateStatus(message, isError = false) {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status ${isError ? 'error' : 'success'}`;
        }

        function checkLibraryStatus() {
            const statusEl = document.getElementById('library-status');
            
            if (typeof window.MarkdownRenderer !== 'undefined') {
                statusEl.innerHTML = `
                    <div class="feature-test feature-pass">✅ MarkdownRenderer loaded</div>
                    <div class="feature-test feature-pass">✅ renderMarkdown function available</div>
                    <div class="feature-test feature-pass">✅ testMarkdownFeatures function available</div>
                `;
                return true;
            } else {
                statusEl.innerHTML = `
                    <div class="feature-test feature-fail">❌ MarkdownRenderer not loaded</div>
                    <p>The markdown library bundle may not have loaded correctly.</p>
                `;
                return false;
            }
        }

        function runTests() {
            updateStatus('Running tests...');
            
            if (!checkLibraryStatus()) {
                updateStatus('Library not loaded - cannot run tests', true);
                return;
            }

            try {
                // Test basic functionality
                const tableMarkdown = document.getElementById('table-input').textContent;
                const advancedMarkdown = document.getElementById('advanced-input').textContent;

                // Render table test
                const tableHtml = window.MarkdownRenderer.renderMarkdown(tableMarkdown);
                document.getElementById('table-output').innerHTML = tableHtml;

                // Render advanced test
                const advancedHtml = window.MarkdownRenderer.renderMarkdown(advancedMarkdown);
                document.getElementById('advanced-output').innerHTML = advancedHtml;

                // Run feature tests
                const testResults = window.MarkdownRenderer.testMarkdownFeatures();
                displayFeatureResults(testResults);

                updateStatus('All tests completed successfully! ✅');

            } catch (error) {
                console.error('Test error:', error);
                updateStatus(`Test failed: ${error.message}`, true);
            }
        }

        function displayFeatureResults(results) {
            const resultsEl = document.getElementById('feature-results');
            let html = '<h3>Feature Test Results:</h3>';

            Object.keys(results).forEach(testName => {
                const result = results[testName];
                const status = result.success && result.hasExpectedElements ? 'pass' : 'fail';
                const icon = status === 'pass' ? '✅' : '❌';
                
                html += `
                    <div class="feature-test feature-${status}">
                        ${icon} ${testName}: ${status.toUpperCase()}
                    </div>
                `;
            });

            html += '<h4>Detailed Results:</h4>';
            html += '<pre>' + JSON.stringify(results, null, 2) + '</pre>';
            
            resultsEl.innerHTML = html;
        }

        // Run tests when page loads
        document.addEventListener('DOMContentLoaded', () => {
            // Give the bundle time to load
            setTimeout(runTests, 100);
        });
    </script>
</body>
</html>
